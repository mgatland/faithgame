
<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>faithgame</title>
    <style>
      body {
        background-color: black;
        text-align: center;
        color: white;
        font-size: 32px;
      }
      canvas {
        border: 1px solid black;
        margin:5px;
        display:inline-block;
      }
      canvas:hover {
        border: 1px solid white;
      }
      .gallery {
        margin: auto;
        max-width: 1024px;
      }
      a {
         color: white;
         text-decoration: none;
      }
    </style>
  </head>
  <body>
    <p>contemplate the work of others</p>
    <div class="gallery">
<!--<a href="cruel_world.html"><img src="cruel_world.png"></a>-->
    </div>
    <p><a href="/">perform the ritual</a></p>
  </body>
  <script>

  function RLE_decode(encoded) {
      var output = "";
      for (var i = 0; i < encoded.length; i += 2) {
        output += new Array(1+encoded[i]).join(encoded[i+1])
      }
      return output;
  }

  var drawThumbnail = function (pixels, colorPalette) {
    var canvas = document.createElement("canvas");
    var width = 100;
    var height = 100;
    var zoomFactor = 1;
    canvas.width = width * zoomFactor;
    canvas.height = height * zoomFactor;
    var visibleContext = canvas.getContext("2d");
    for (var i=0;i<width;i++){
      for (var j=0;j<height;j++){
        var pixelIndex = pixels[i+width*j]; 
        visibleContext.fillStyle=colorPalette[pixelIndex];
        visibleContext.fillRect(i*zoomFactor,j*zoomFactor,zoomFactor,zoomFactor);
      }
    }
    return canvas;
  }

  var drawGallery = function(games) {
    for(var i = 0; i < games.length; i++) {
      var link = document.createElement("a");
      link.href = "/play.html?p=" + i;
      var pixels = RLE_decode(games[i].thumbnail);
      var colorPalette = games[i].colorPalette;
      var canvas = drawThumbnail(pixels, colorPalette);
      link.appendChild(canvas);

      document.querySelector(".gallery").appendChild(link);
    }    
  }

  function httpGetAsync(theUrl, callback)
  {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.onreadystatechange = function() { 
          if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
              callback(JSON.parse(xmlHttp.responseText));
      }
      xmlHttp.open("GET", theUrl, true); // true for asynchronous 
      xmlHttp.send(null);
  }

  httpGetAsync("/games", drawGallery);

  </script>
</html>
